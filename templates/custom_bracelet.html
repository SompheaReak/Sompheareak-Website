<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Customize Your Italy Bracelet</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body { 
        font-family: Arial, sans-serif; 
        background: #fafafa; 
        margin: 0; 
        padding: 0; 
        text-align: center; 
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .header { 
        position: sticky; 
        top: 0; 
        background: white; 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        padding: 10px 20px; 
        box-shadow: 0 2px 6px rgba(0,0,0,0.1); 
        z-index: 1000; 
        width: 100%; 
        flex-wrap: wrap; /* Allow items to wrap on smaller screens */
        gap: 10px; /* Space between header items */
    }
    .back-home { 
        background: #007bff; 
        color: white; 
        padding: 10px 18px; 
        border-radius: 8px; 
        text-decoration: none; 
        font-weight: bold; 
    }
    h2.title { margin-top: 20px; color: #333; }

    /* GIF Style */
    .header-gif {
        max-height: 50px; /* Adjust as needed */
        width: auto;
        margin: 0 10px; /* Space around the GIF */
    }


    .preview-box { position: sticky; top: 60px; background: #fff; border: 2px solid #ddd; border-radius: 12px; margin: 20px auto; padding: 20px; width: 90%; max-width: 900px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
    .preview-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; flex-wrap: wrap; gap: 10px; } /* Wrap for mobile */
    .cancel-btn { background: #ff4c4c; color:white; border:none; padding:8px 16px; border-radius:6px; font-weight:bold; cursor:pointer; }
    #bracelet-preview { display:flex; justify-content:flex-start; align-items:flex-start; overflow-x:auto; gap:5px; padding:10px; min-height:160px; }
    .bracelet-charm { position:relative; margin:0; }
    .remove-btn { position:absolute; top:-15px; left:50%; transform:translateX(-50%); background:red; color:white; border:none; border-radius:50%; font-size:14px; width:26px; height:26px; cursor:pointer; box-shadow:0 2px 5px rgba(0,0,0,0.2); transition:0.2s; z-index: 10; }
    .remove-btn:hover { background:#cc0000; transform:translateX(-50%) scale(1.1); }
    .bracelet-charm img { width:90px; height:150px; object-fit:cover; }
    .controls { display:flex; gap:5px; margin-top:5px; justify-content: center; }
    .move-left, .move-right { border:none; background:rgba(0,0,0,0.4); color:white; border-radius:4px; font-size:14px; padding:2px 6px; cursor:pointer; }

    .total-box { margin-top:10px; text-align:center; }
    .total-box p { font-size:18px; font-weight:bold; margin:5px 0; }
    .action-buttons { display:flex; justify-content:center; gap:10px; flex-wrap:wrap; }

    /* Button Styles */
    .add-recommended-btn { background:#ff9800; color:white; border:none; padding:10px 18px; border-radius:8px; font-size:16px; cursor:pointer; transition:0.2s; }
    .add-recommended-btn:hover { background:#e68900; transform:scale(1.05); }

    .add-to-cart-btn { 
        background: #007bff; 
        color: white; 
        border: none; 
        padding: 10px 18px; 
        border-radius: 8px; 
        font-size: 16px; 
        cursor: pointer; 
        transition: 0.2s; 
    }
    .add-to-cart-btn:hover {
        background: #0056b3;
        transform: scale(1.05);
    }
    /* End Button Styles */


    /* Category gallery - Mobile Friendly */
    .category-gallery { 
        display:grid; 
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); /* Min size 140px, adjust columns */
        gap:20px; 
        padding:20px;
        max-width: 900px; 
        width: 90%; 
        margin:0 auto; 
        justify-content: center; 
    }
    .category-item { 
        background:white; 
        border:2px solid #eee; 
        border-radius:10px; 
        padding: 20px 15px;
        cursor:pointer; 
        transition:0.2s; 
        text-align:center; 
        font-size: 1.2rem; 
        margin: 0; 
        opacity: 1 !important; 
    }
    .category-item:hover { 
        border-color:#eee; 
        transform: none; 
    }
    
    .category-item img { width:100px; height:150px; object-fit:cover; border-radius:8px; }

    /* Modal */
    .modal { 
        position:fixed; 
        top:0; 
        left:0; 
        width:100%; 
        height:100%; 
        background: rgba(0,0,0,0.5); 
        display:none; 
        justify-content:center; 
        align-items:flex-end; 
        z-index:10000; 
        backdrop-filter: none; 
    }
    .modal-content { 
        background:white; 
        padding:20px; 
        border-radius:10px 10px 0 0; 
        width: 100%; 
        max-width: none; 
        max-height: 50vh; 
        height: auto; 
        overflow-y: auto; 
        text-align:center; 
        position: relative; 
        bottom: 0;
        left: 0; 
        transform: none; 
    }
    
    /* Charm Grid inside Modal - Mobile Friendly */
    .charm-grid { 
        display:grid; 
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); 
        max-width: 500px; /* Still constrain for large screens */
        margin: 0 auto;
        gap: 15px; 
    }
    
    .recommended-item { 
        background:white; 
        border:2px solid #eee; 
        border-radius:10px; 
        padding:10px; 
        cursor:pointer; 
        transition:0.2s; 
        text-align: center;
    }
    .recommended-item:hover { border-color:#007bff; transform:scale(1.05); }
    /* Adjusted image size for selection tiles */
    .recommended-item img { 
        width: 60px; 
        height: 100px; 
        object-fit:cover; 
        border-radius:10px; 
    }
    
    /* CLOSE BUTTON TOP-RIGHT */
    .close-modal-btn { 
        margin-top:0; 
        background:#ff4c4c; 
        color:white; 
        border:none; 
        padding:8px 14px; 
        border-radius:4px; 
        cursor:pointer; 
        
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 10001; 
    }

    /* Media Queries for Mobile Responsiveness */
    @media (max-width: 768px) {
        .header {
            flex-direction: column; /* Stack header items */
            align-items: flex-start; /* Align to the left */
            padding: 10px;
        }
        .header h3 {
            order: 1; /* Place title below buttons */
            width: 100%;
            text-align: center;
            margin-top: 10px;
        }
        .back-home {
            order: 0; /* Keep back home first */
        }
        .header-gif {
            order: 2; /* Place GIF below title */
            margin-top: 10px;
        }
        
        .preview-box {
            top: 10px; /* Adjust sticky position for smaller screens */
            width: 95%;
            margin: 10px auto;
        }
        .preview-header {
            flex-direction: column;
            align-items: center;
        }
        .add-to-cart-btn, .add-recommended-btn {
            width: 100%; /* Full width buttons on mobile */
        }

        .category-gallery {
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); /* 2-3 columns on mobile */
            gap: 15px;
            padding: 10px;
        }

        .charm-grid {
            grid-template-columns: repeat(auto-fit, minmax(70px, 1fr)); /* 3-4 columns on mobile */
            gap: 10px;
            max-width: 100%; /* Allow grid to use full modal width on small screens */
            padding-bottom: 50px; /* Prevent close button from overlapping last row */
        }

        .modal-content {
            max-height: 75vh; /* Increase modal height on small screens */
            padding: 15px;
        }
    }

    @media (max-width: 480px) {
        .category-gallery {
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); /* 2 columns on very small mobile */
            gap: 10px;
        }
        .charm-grid {
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr)); /* 2-3 columns on very small mobile */
        }
        .bracelet-charm img {
            width: 70px; /* Smaller charms in preview on very small screens */
            height: 120px;
        }
        .remove-btn {
            width: 22px;
            height: 22px;
            font-size: 12px;
        }
    }

</style>
</head>
<body>

  <div class="header">
    <a href="/" class="back-home">üè† Back to Home</a>
    <img src="YOUR_GIF_URL_HERE" alt="Decorative GIF" class="header-gif">
    <h3>Customize Your Bracelet</h3>
  </div>

  <div class="preview-box" id="previewBox">
    <div class="preview-header">
      <h3>ü™Ñ Preview Bracelet</h3>
      <button id="cancelSelection" class="cancel-btn">‚ùå Cancel Selection</button>
    </div>

    <div id="bracelet-preview">Your charms will appear here...</div>

    <div class="total-box">
      <p>Total Charms: <span id="totalCharms">0</span></p>
      <p>Total Price: <span id="totalPrice">0·üõ</span></p>
      <div class="action-buttons">
        <button class="add-to-cart-btn" id="addToCartBtn">üõçÔ∏è Add to Cart</button>
        <button class="add-recommended-btn" id="recommendedBtn">‚ú® Add Recommended Charm</button>
      </div>
    </div>
  </div>

  <h2 class="title">ü™Ñ Choose a Category ü™Ñ</h2>
  <div id="categoryGallery" class="category-gallery"></div>

  <div id="charmModal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <h3 id="modalTitle"></h3>
      <div id="charmGrid" class="charm-grid"></div>
      <button id="closeModalBtn" class="close-modal-btn">Close</button>
    </div>
  </div>

  <script>
    // DOM refs
    const preview = document.getElementById('bracelet-preview');
    const totalPrice = document.getElementById('totalPrice');
    const totalCharms = document.getElementById('totalCharms'); 
    const categoryGallery = document.getElementById('categoryGallery');
    const charmModal = document.getElementById('charmModal');
    const charmGrid = document.getElementById('charmGrid');
    const modalTitle = document.getElementById('modalTitle');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const recommendedBtn = document.getElementById('recommendedBtn');
    const addToCartBtn = document.getElementById('addToCartBtn'); 

    let charms = []; // current preview charms

    const allCharms = [
      // --- Charm
    {"id": 1, "name_kh": "Silver Charm", "price": 400, "image": "/static/images/c01.jpg", "categories": ["Charm"]},
    // --- CAR LOGOS (cc01 - cc15) ---
    {"id": 12301, "name_kh": "Car Charm 01", "price": 3000, "image": "/static/images/cc01.jpg", "categories": ["Car Logo"]},
    {"id": 12302, "name_kh": "Car Charm 02", "price": 3000, "image": "/static/images/cc02.jpg", "categories": ["Car Logo"]},
    {"id": 12303, "name_kh": "Car Charm 03", "price": 3000, "image": "/static/images/cc03.jpg", "categories": ["Car Logo"]},
    {"id": 12304, "name_kh": "Car Charm 04", "price": 3000, "image": "/static/images/cc04.jpg", "categories": ["Car Logo"]},
    {"id": 12305, "name_kh": "Car Charm 05", "price": 3000, "image": "/static/images/cc05.jpg", "categories": ["Car Logo"]},
    {"id": 12306, "name_kh": "Car Charm 06", "price": 3000, "image": "/static/images/cc06.jpg", "categories": ["Car Logo"]},
    {"id": 12307, "name_kh": "Car Charm 07", "price": 3000, "image": "/static/images/cc07.jpg", "categories": ["Car Logo"]}, 
    {"id": 12308, "name_kh": "Car Charm 08", "price": 3000, "image": "/static/images/cc08.jpg", "categories": ["Car Logo"]},
    {"id": 12309, "name_kh": "Car Charm 09", "price": 3000, "image": "/static/images/cc09.jpg", "categories": ["Car Logo"]},
    {"id": 12310, "name_kh": "Car Charm 10", "price": 3000, "image": "/static/images/cc10.jpg", "categories": ["Car Logo"]},
    {"id": 12311, "name_kh": "Car Charm 11", "price": 3000, "image": "/static/images/cc11.jpg", "categories": ["Car Logo"]},
    {"id": 12312, "name_kh": "Car Charm 12", "price": 3000, "image": "/static/images/cc12.jpg", "categories": ["Car Logo"]},
    {"id": 12313, "name_kh": "Car Charm 13", "price": 3000, "image": "/static/images/cc13.jpg", "categories": ["Car Logo"]},
    {"id": 12314, "name_kh": "Car Charm 14", "price": 3000, "image": "/static/images/cc14.jpg", "categories": ["Car Logo"]},
    {"id": 12315, "name_kh": "Car Charm 15", "price": 3000, "image": "/static/images/cc15.jpg", "categories": ["Car Logo"]},

    // --- FLAGS (cf01 - cf19) ---
    {"id": 1234501, "name_kh": "Flag Charm 01", "price": 3000, "image": "/static/images/cf01.jpg", "categories": ["Flag"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 1234502, "name_kh": "Flag Charm 02", "price": 3000, "image": "/static/images/cf02.jpg", "categories": ["Flag"], "subcategory": ["Flag","Football"], "discount": 20},
    {"id": 1234503, "name_kh": "Flag Charm 03", "price": 3000, "image": "/static/images/cf03.jpg", "categories": ["Flag"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 1234504, "name_kh": "Flag Charm 04", "price": 3000, "image": "/static/images/cf04.jpg", "categories": ["Flag"], "subcategory": ["Flag","Football"], "discount": 20},
    {"id": 1234505, "name_kh": "Flag Charm 05", "price": 3000, "image": "/static/images/cf05.jpg", "categories": ["Flag"], "subcategory": ["Flag","Football"], "discount": 20},
    {"id": 1234506, "name_kh": "Flag Charm 06", "price": 3000, "image": "/static/images/cf06.jpg", "categories": ["Flag"], "subcategory": ["Flag","Football"], "discount": 20},
    {"id": 1234507, "name_kh": "Flag Charm 07", "price": 3000, "image": "/static/images/cf07.jpg", "categories": ["Flag"], "subcategory": ["Flag","Football"], "discount": 20},
    {"id": 1234508, "name_kh": "Flag Charm 08", "price": 3000, "image": "/static/images/cf08.jpg", "categories": ["Flag"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 1234509, "name_kh": "Flag Charm 09", "price": 3000, "image": "/static/images/cf09.jpg", "categories": ["Flag"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 1234510, "name_kh": "Flag Charm 10", "price": 3000, "image": "/static/images/cf10.jpg", "categories": ["Flag"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 1234511, "name_kh": "Flag Charm 11", "price": 3000, "image": "/static/images/cf11.jpg", "categories": ["Flag"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 1234512, "name_kh": "Flag Charm 12", "price": 3000, "image": "/static/images/cf12.jpg", "categories": ["Flag"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 1234513, "name_kh": "Flag Charm 13", "price": 3000, "image": "/static/images/cf13.jpg", "categories": ["Flag"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 1234514, "name_kh": "Flag Charm 14", "price": 3000, "image": "/static/images/cf14.jpg", "categories": ["Flag"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 1234515, "name_kh": "Flag Charm 15", "price": 3000, "image": "/static/images/cf15.jpg", "categories": ["Flag"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 1234516, "name_kh": "Flag Charm 16", "price": 3000, "image": "/static/images/cf16.jpg", "categories": ["Flag"], "subcategory": ["Flag","Football"], "discount": 20},
    {"id": 1234517, "name_kh": "Flag Charm 17", "price": 3000, "image": "/static/images/cf17.jpg", "categories": ["Flag"], "subcategory": ["Flag","Football"], "discount": 20},
    {"id": 1234518, "name_kh": "Flag Charm 18", "price": 3000, "image": "/static/images/cf18.jpg", "categories": ["Flag"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 1234519, "name_kh": "Flag Charm 19", "price": 3000, "image": "/static/images/cf19.jpg", "categories": ["Flag"], "subcategory": ["All","Football"], "discount": 20},

    // --- GEMSTONES (cg01 - cg24) ---
    {"id": 123501, "name_kh": "Gemstone Charm 01", "price": 3500, "image": "/static/images/cg01.jpg", "categories": ["Gemstone"], "subcategory": ["Car Logo"], "discount": 20},
    {"id": 123502, "name_kh": "Gemstone Charm 02", "price": 3500, "image": "/static/images/cg02.jpg", "categories": ["Gemstone"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 123503, "name_kh": "Gemstone Charm 03", "price": 3500, "image": "/static/images/cg03.jpg", "categories": ["Gemstone"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 123504, "name_kh": "Gemstone Charm 04", "price": 3500, "image": "/static/images/cg04.jpg", "categories": ["Gemstone"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 123505, "name_kh": "Gemstone Charm 05", "price": 3500, "image": "/static/images/cg05.jpg", "categories": ["Gemstone"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 123506, "name_kh": "Gemstone Charm 06", "price": 3500, "image": "/static/images/cg06.jpg", "categories": ["Gemstone"], "subcategory": ["Car Logo"], "discount": 20},
    {"id": 123507, "name_kh": "Gemstone Charm 07", "price": 3500, "image": "/static/images/cg07.jpg", "categories": ["Gemstone"], "subcategory": ["Car Logo"], "discount": 20},
    {"id": 123508, "name_kh": "Gemstone Charm 08", "price": 3500, "image": "/static/images/cg08.jpg", "categories": ["Gemstone"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 123509, "name_kh": "Gemstone Charm 09", "price": 3500, "image": "/static/images/cg09.jpg", "categories": ["Gemstone"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 123510, "name_kh": "Gemstone Charm 10", "price": 3500, "image": "/static/images/cg10.jpg", "categories": ["Gemstone"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 123511, "name_kh": "Gemstone Charm 11", "price": 3500, "image": "/static/images/cg11.jpg", "categories": ["Gemstone"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 123512, "name_kh": "Gemstone Charm 12", "price": 3500, "image": "/static/images/cg12.jpg", "categories": ["Gemstone"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 123513, "name_kh": "Gemstone Charm 13", "price": 3500, "image": "/static/images/cg13.jpg", "categories": ["Gemstone"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 123514, "name_kh": "Gemstone Charm 14", "price": 3500, "image": "/static/images/cg14.jpg", "categories": ["Gemstone"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 123515, "name_kh": "Gemstone Charm 15", "price": 3500, "image": "/static/images/cg15.jpg", "categories": ["Gemstone"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 123516, "name_kh": "Gemstone Charm 16", "price": 3500, "image": "/static/images/cg16.jpg", "categories": ["Gemstone"], "subcategory": ["Car Logo"], "discount": 20},
    {"id": 123517, "name_kh": "Gemstone Charm 17", "price": 3500, "image": "/static/images/cg17.jpg", "categories": ["Gemstone"], "subcategory": ["Car Logo"], "discount": 20},
    {"id": 123518, "name_kh": "Gemstone Charm 18", "price": 3500, "image": "/static/images/cg18.jpg", "categories": ["Gemstone"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 123519, "name_kh": "Gemstone Charm 19", "price": 3500, "image": "/static/images/cg19.jpg", "categories": ["Gemstone"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 123520, "name_kh": "Gemstone Charm 20", "price": 3500, "image": "/static/images/cg20.jpg", "categories": ["Gemstone"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 123521, "name_kh": "Gemstone Charm 21", "price": 5000, "image": "/static/images/cg21.jpg", "categories": ["Gemstone"], "subcategory": ["Car Logo"], "discount": 20},
    {"id": 123522, "name_kh": "Gemstone Charm 22", "price": 5000, "image": "/static/images/cg22.jpg", "categories": ["Gemstone"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 123523, "name_kh": "Gemstone Charm 23", "price": 5000, "image": "/static/images/cg23.jpg", "categories": ["Gemstone"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 123524, "name_kh": "Gemstone Charm 24", "price": 5000, "image": "/static/images/cg24.jpg", "categories": ["Gemstone"], "subcategory": ["All","Football"], "discount": 20},
        // --- Black Lover 
    {"id": 101, "name_kh": "Chain ", "price": 3000, "image": "/static/images/charm-chain-01.jpg", "categories": ["Chain"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 102, "name_kh": "Chain", "price": 3000, "image": "/static/images/charm-chain-02.jpg", "categories": ["Chain"], "subcategory": ["Flag","Football"], "discount": 20},
    {"id": 103, "name_kh": "Chain", "price": 3000, "image": "/static/images/charm-chain-03.jpg", "categories": ["Chain"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 104, "name_kh": "Chain", "price": 3000, "image": "/static/images/charm-chain-04.jpg", "categories": ["Chain"], "subcategory": ["Flag","Football"], "discount": 20},
    {"id": 105, "name_kh": "Chain ", "price": 3000, "image": "/static/images/charm-chain-05.jpg", "categories": ["Chain"], "subcategory": ["All","Football"], "discount": 20},
    {"id": 106, "name_kh": "Chain", "price": 3000, "image": "/static/images/charm
