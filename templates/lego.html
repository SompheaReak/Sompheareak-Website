<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Somphea Reak | LEGO Market</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #ffffff; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .snap-x { scroll-snap-type: x mandatory; }
        .snap-start { scroll-snap-align: start; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useRef } = React;

        // --- ICONS ---
        const ShoppingBag = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>;
        const ChevronRight = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>;
        const ChevronLeft = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m15 18-6-6 6-6"/></svg>;

        // --- PRODUCT CATALOG ---
        const PRODUCTS_DATA = [
            {"id": 20001, "name_kh": "71049 - 1 RED BULL","price": 24000, "image": "/static/images/lego71049-01.jpg", "categories": ["LEGO", "Toy"], "subcategory": ["Formula 1"],"stock": 1,"discount":0 },
            {"id": 20002, "name_kh": "71049 - 2 MERCEDES","price": 24000, "image": "/static/images/lego71049-02.jpg", "categories": ["LEGO", "Toy"], "subcategory": ["Formula 1"],"stock": 1,"discount":0 },
            {"id": 2002, "name_kh": "WWII - Cannon 6x","price": 6000, "image": "/static/images/wwii-gun6x.jpg", "categories": ["toy"], "subcategory": "Lego WWII","discount":0},
            {"id": 1, "name_kh": "#OP01 One Piece - Sakazuki","price": 7500, "image": "/static/images/op01.jpg", "categories": ["LEGO Anime", "Toy"], "subcategory": ["One Piece"],"stock": 1,"discount":0 },
            {"id": 101, "name_kh": "NINJAGO S1 - DX Suit","price": 30000, "image": "/static/images/njoss1dx.jpg", "categories": ["LEGO Ninjago", "Toy"], "subcategory": ["Lego Ninjago","Season 1"],"stock": 1},
            {"id": 1901, "name_kh": "Dragon Rising S1 - KAI","price": 5000, "image": "/static/images/njodrgss1mergekai.jpg", "categories": ["LEGO Ninjago", "Toy"], "subcategory": ["Lego Ninjago","Dragon Rising"],"stock": 1},
            {"id": 91101, "name_kh": "Zane's Titan Mech","price": 68000, "image": "/static/images/nj01.jpg", "categories": ["LEGO Ninjago","Toy"], "subcategory": ["Lego Ninjago","Building Set"]},
        ];

        const ProductCard = ({ product }) => (
            <div className="bg-white rounded-lg border border-gray-200 overflow-hidden flex flex-col h-full min-w-[220px] w-[220px] snap-start">
                <div className="aspect-square p-4"><img src={product.image} className="w-full h-full object-contain" onError={(e) => e.target.src="https://placehold.co/400?text=LEGO"} /></div>
                <div className="p-4 flex flex-col flex-grow">
                    <h3 className="text-sm font-bold text-gray-900 mb-2 h-10 line-clamp-2">{product.name_kh}</h3>
                    <div className="mt-auto">
                        <span className="text-lg font-black block">áŸ›{product.price.toLocaleString()}</span>
                        <button className="w-full mt-3 bg-orange-500 text-white font-bold py-2 rounded-full text-xs uppercase">Add to Bag</button>
                    </div>
                </div>
            </div>
        );

        const SectionRow = ({ title, products }) => {
            const scrollRef = useRef(null);
            if (products.length === 0) return null;
            return (
                <div className="py-8 border-b border-gray-100 last:border-0">
                    <h2 className="px-6 mb-4 text-xl font-black uppercase tracking-tight italic">{title}</h2>
                    <div ref={scrollRef} className="flex overflow-x-auto gap-4 px-6 pb-4 hide-scrollbar snap-x">
                        {products.map(p => <ProductCard key={p.id} product={p} />)}
                    </div>
                </div>
            );
        };

        function App() {
            const [filter, setFilter] = useState("All");

            const groupedProducts = useMemo(() => {
                const groups = {};
                PRODUCTS_DATA.forEach(p => {
                    // Filter Logic
                    let show = false;
                    if (filter === "All") show = true;
                    if (filter === "Ninjago" && p.categories.includes("LEGO Ninjago")) show = true;
                    if (filter === "Anime" && p.categories.includes("LEGO Anime")) show = true;
                    if (filter === "Vehicles" && p.subcategory.includes("Formula 1")) show = true;

                    if (!show) return;

                    // Grouping Logic
                    let groupName = Array.isArray(p.subcategory) ? p.subcategory[p.subcategory.length-1] : p.subcategory;
                    if (!groups[groupName]) groups[groupName] = [];
                    groups[groupName].push(p);
                });
                return Object.entries(groups);
            }, [filter]);

            return (
                <div className="min-h-screen">
                    <header className="sticky top-0 z-50 bg-white border-b px-6 py-4 flex items-center justify-between">
                        <a href="/" className="flex items-center gap-2">
                            <div className="bg-red-600 text-white font-black p-1 text-xl italic">LEGO</div>
                            <span className="font-bold">Market</span>
                        </a>
                        <ShoppingBag className="w-6 h-6" />
                    </header>

                    <div className="flex gap-4 p-6 overflow-x-auto hide-scrollbar bg-gray-50 border-b">
                        {["All", "Ninjago", "Anime", "Vehicles"].map(t => (
                            <button key={t} onClick={() => setFilter(t)} 
                                className={`px-6 py-2 rounded-full font-bold text-sm whitespace-nowrap transition-colors ${filter === t ? 'bg-yellow-400 text-black' : 'bg-white border border-gray-200 text-gray-500'}`}>
                                {t}
                            </button>
                        ))}
                    </div>

                    <main className="max-w-7xl mx-auto">
                        {groupedProducts.length > 0 ? groupedProducts.map(([title, items]) => (
                            <SectionRow key={title} title={title} products={items} />
                        )) : <div className="p-20 text-center font-bold text-gray-400">No products found in this category.</div>}
                    </main>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>

