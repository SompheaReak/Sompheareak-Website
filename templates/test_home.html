<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEST - Minifigure Home & Categories</title>
    <script src="https://cdn.tailwindcss.com"></script> 
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bungee+Inline&family=Inter:wght@100..900&display=swap');
        
        :root {
            --lego-yellow: #FFC300;
            --lego-red: #C80815;
            --gacha-bg: #1f2937; /* Gray-800 */
        }
        
        body {
            font-family: 'Inter', sans-serif;
        }

        /* ONLY KEEPING essential styles for a Home/Category view */
        .draw-button-style {
            background-color: var(--lego-red);
            box-shadow: 0 5px 0 0 #A80008;
            transform: translateY(0);
            transition: all 0.1s ease-out;
        }
        .draw-button-style:active:not(:disabled) {
            transform: translateY(5px);
            box-shadow: 0 0 0 0 #A80008;
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen bg-gray-900 flex flex-col items-center">

    <div id="minifigure-app-test" class="w-full max-w-sm bg-gray-800 border-4 border-yellow-500 shadow-2xl p-6 rounded-xl relative overflow-hidden">
        
        <div class="flex justify-center items-center mb-6">
            <h1 class="text-3xl font-black text-yellow-500 text-center uppercase tracking-wider font-['Bungee_Inline'] drop-shadow-lg shadow-black/50">
                üß™ Test Environment üöÄ
            </h1>
        </div>
        
        <div class="mb-4 p-2 rounded-lg bg-gray-700 shadow-inner border border-gray-600 text-center">
            <span class="text-sm font-semibold text-gray-300">Test Player ID:</span>
            <code id="user-id-display" class="text-3xl font-mono font-extrabold text-red-400 block tracking-widest">...</code>
        </div>

        <div id="datetime-display" class="mb-8 p-2 text-center rounded-lg bg-gray-700 border border-gray-600">
        </div>

        <a href="test_lucky_draw.html" class="block w-full text-center">
            <button class="w-full py-4 text-xl font-bold text-white rounded-xl transition duration-150 uppercase draw-button-style">
                Launch Mystery Draw! üéÅ
            </button>
        </a>

        <div class="mt-6 p-4 border-t border-gray-700">
            <h2 class="text-lg font-bold text-gray-300 mb-2">Other Categories</h2>
            <ul class="space-y-2 text-gray-400">
                <li><a href="#" class="hover:text-yellow-500">Minifigure Guides (Coming Soon)</a></li>
                <li><a href="#" class="hover:text-yellow-500">Trade Hub (Offline)</a></li>
            </ul>
        </div>
        
    </div>
    
    <script>
    // --- üí• CUSTOM MINIFIGURE WEIGHTS üí• ---
    const FIGURE_STRINGS = [ 
     'name:"Kai (DX)", rarity:"Common", weight:80, color:"red-600", image_url:"static/images/lucky-01.jpg"',
     'name:"Pixal (REBOOTED)", rarity:"Super Rare", weight:40, color:"red-600", image_url:"static/images/lucky-76.jpg"',
       ];
    // ----------------------------------------
    
    // Global state
    let MINIFIGURES = [];
    let currentDraws = 0;
    let USER_ID = null; 
    
    // UI Elements
    const userIdDisplay = document.getElementById('user-id-display');
    
    // --- CODE CONSTANTS ---
    // !!! CRITICAL CHANGE: Changed localStorage key to prevent clash !!!
    const USER_ID_KEY = 'minifigure_test_user_id'; 
    // Kept constants needed for User ID and Time

    // --- User ID Management (Simple 4-Digit ID) ---
    function generateSimpleID() {
        const num = Math.floor(Math.random() * 9999) + 1;
        return String(num).padStart(4, '0');
    }

    function getUserID() {
        let id = localStorage.getItem(USER_ID_KEY);
        if (!id) {
            id = generateSimpleID();
            localStorage.setItem(USER_ID_KEY, id);
        }
        USER_ID = id;
        if (userIdDisplay) {
            // Added (T) for Test ID to clearly distinguish it
            userIdDisplay.textContent = USER_ID + ' (T)'; 
        }
    }

    // --- Cambodia Time Logic ---
    function getOrdinal(d) {
        if (d > 3 && d < 21) return 'th'; 
        switch (d % 10) {
            case 1: return "st";
            case 2: return "nd";
            case 3: return "rd";
            default: return "th";
        }
    }
    
    function updateCambodiaTime() {
        const now = new Date();
        const options = {
            timeZone: 'Asia/Phnom_Penh',
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit', 
            minute: '2-digit',
            second: '2-digit',
            hour12: false
        };

        const formatter = new Intl.DateTimeFormat('en-US', options);
        const parts = formatter.formatToParts(now);

        let day, month, year, hour, minute, second;

        parts.forEach(part => {
            if (part.type === 'day') day = part.value;
            if (part.type === 'month') month = part.value;
            if (part.type === 'year') year = part.value;
            if (part.type === 'hour') hour = part.value; 
            if (part.type === 'minute') minute = part.value;
            if (part.type === 'second') second = part.value;
        });

        const dayInt = parseInt(day, 10);
        const formattedDate = `${dayInt}${getOrdinal(dayInt)}/${month}/${year}`;
        const formattedTime = `${hour}h ${minute}m ${second}s`;
        
        const datetimeDisplay = document.getElementById('datetime-display');
        if (datetimeDisplay) {
            datetimeDisplay.innerHTML = `
                <p class="text-sm font-semibold text-gray-400">Time in Phnom Penh (UTC+7)</p>
                <p class="text-base font-bold text-gray-300">${formattedDate} | ${formattedTime}</p>
            `;
        }
    }
    
    // --- Initialization ---

    function initGame() {
        getUserID(); 
        
        // Start the real-time clock update
        updateCambodiaTime();
        setInterval(updateCambodiaTime, 1000); 
    }

    document.addEventListener('DOMContentLoaded', initGame);
</script>
</body>
</html>
